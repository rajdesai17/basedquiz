# Base Trivia Mini App — Minimal MVP (MiniKit)

A tiny, fun daily trivia Mini App that runs inside Base App (MiniKit). Each day shows 5 easy questions about Base, Coinbase, Web3, blockchain, and onchain—generated by Google Gemini and stored in Supabase. Users sign in with their wallet via MiniKit, play once per day, and see a lightweight leaderboard.

---

## MVP Scope

- Daily set of 5 beginner-friendly multiple-choice questions (Base, Coinbase, Web3, blockchain, onchain)
- Wallet sign-in via Base MiniKit; identify users by `wallet_address`
- Submit once per day per wallet; show a daily leaderboard
- Questions generated once per day using Google Gemini and persisted in Supabase
- Zero onchain/contracts for MVP (no paid entry, no claims, no NFTs)

Non-goals for MVP (backlog): paid prize pool, signature claims, NFTs, IPFS, advanced anti-cheat, complex admin tools.

---

## Tech stack

- Frontend: Next.js (App Router), TypeScript, React, Tailwind CSS (v4)
- Mini App: Base MiniKit (Provider + hooks) running inside Base App
- Backend: Next.js API routes (Node.js)
- DB: Supabase (Postgres) for rounds, questions, scores
- AI: Google Gemini (via `@google/genai`) for daily question generation
- Hosting: Vercel (with Vercel Cron for daily generation)

---

## Quickstart (Windows PowerShell)

```powershell
# 1) Scaffold a MiniKit app
npx create-onchain --mini

# 2) Install deps (Tailwind v4, Supabase, Gemini)
npm install tailwindcss @tailwindcss/postcss postcss
npm install @supabase/supabase-js zod
npm install @google/genai

# 3) Init Tailwind v4
# Configure postcss.config.js to use the "@tailwindcss/postcss" plugin and set Tailwind content paths

# 4) Run dev
npm run dev
```

Environment variables (local + Vercel):

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE` (server-only, for scheduled generation) or use an RLS-enabled approach
- `GEMINI_API_KEY`

---

## Minimal data model (Supabase)

```sql
-- Daily round: one per date
CREATE TABLE IF NOT EXISTS daily_rounds (
  id SERIAL PRIMARY KEY,
  date DATE UNIQUE NOT NULL,
  status TEXT NOT NULL DEFAULT 'active',
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Questions generated by Gemini, tied to a round
CREATE TABLE IF NOT EXISTS questions (
  id SERIAL PRIMARY KEY,
  round_id INTEGER NOT NULL REFERENCES daily_rounds(id) ON DELETE CASCADE,
  category TEXT NOT NULL, -- Base | Coinbase | Web3 | Blockchain | Onchain
  question_text TEXT NOT NULL,
  options JSONB NOT NULL, -- [string, string, string, string]
  correct_index INTEGER NOT NULL CHECK (correct_index BETWEEN 0 AND 3),
  explanation TEXT,
  source TEXT DEFAULT 'gemini',
  generated_at TIMESTAMPTZ DEFAULT now()
);

-- One score per wallet per round
CREATE TABLE IF NOT EXISTS scores (
  id SERIAL PRIMARY KEY,
  round_id INTEGER NOT NULL REFERENCES daily_rounds(id) ON DELETE CASCADE,
  wallet_address TEXT NOT NULL,
  correct_count INTEGER NOT NULL,
  total INTEGER NOT NULL DEFAULT 5,
  time_ms INTEGER NOT NULL, -- simple tiebreaker
  submitted_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE (round_id, wallet_address)
);
```

Indexes to add:

- `CREATE INDEX ON scores (round_id, correct_count DESC, time_ms ASC);`
- `CREATE INDEX ON questions (round_id);`

---

## Minimal API

- `GET /api/daily`
  - Returns `{ round, questions }` for today (creates round if missing in dev; in prod this is created by the daily job)

- `POST /api/score`
  - Body: `{ roundId: number, wallet: string, answers: number[], elapsedMs: number }`
  - Server checks answers vs. `questions.correct_index`, computes `correct_count`, inserts score if not already submitted

- `GET /api/leaderboard?roundId=...` (defaults to today)
  - Returns top scores ordered by `correct_count DESC, time_ms ASC`

MVP auth: Accept `wallet` from MiniKit context on the client and pass it to the API. Enforce one submission per round via DB `UNIQUE (round_id, wallet_address)`.

---

## Daily question generation (Gemini)

Questions must be topical and easy: Base, Coinbase, Web3, blockchain, onchain. Keep them fun and beginner-friendly.

Install SDK:

```powershell
npm install @google/genai
```

Generation flow:

- A protected server endpoint (e.g., `POST /api/admin/generate`) runs once daily (Vercel Cron) with `GEMINI_API_KEY`
- Prompt Gemini for 5 easy questions across the categories with 4 options and a single correct index
- Upsert today’s `daily_rounds` row and persist 5 `questions`
- Basic validation: ensure 5 questions, 4 options each, indices in 0–3, no empty text

Safety settings: keep temperature modest (~0.6), block unsafe content, and filter for simplicity.

---

## Pages (minimal)

- `/play`
  - Fetch today’s `{ round, questions }`
  - 5-question sequence with simple timer (e.g., 60s total)
  - On submit, compute elapsed ms client-side and call `POST /api/score`
  - Show the result and link to leaderboard

- `/leaderboard`
  - Fetch top scores for today and render list/table

Optional landing `/` can just deep-link to `/play` inside Base App.

---

## MiniKit integration (essentials)

- Wrap app in `MiniKitProvider`
- Read wallet address via MiniKit hooks and pass to API
- Add Mini App manifest when deploying so it runs inside Base App

---

## Lightweight anti-abuse (MVP)

- One submission per wallet per day enforced by DB unique constraint
- Simple time limit in UI; use `time_ms` as a tie-breaker
- Optional IP rate limit on API routes

No signatures or complex proofs in MVP.

---

## build plan (minimal)

-  1: Scaffold MiniKit app, Tailwind, pages `/play`, `/leaderboard`
-  2: Supabase schema + client/server wiring
-  3: `/api/daily`, `/api/score`, `/api/leaderboard`
-  4: Gemini generate + persist; admin-only daily generation route
-  5: UI polish, timer, empty/error/loading states
-  6: Vercel deploy + Vercel Cron for daily generation
-  7: QA in Base App, fix bugs, ship

---

## Backlog (v2+)

- Onchain prize pool + claims flow
- NFT “stamp” mint per play day
- Advanced anti-cheat (proof signing, heuristics)
- Categories/difficulty selection, streaks, seasons
- Social share, notifications, analytics

---

## References & Docs

- **Base MiniKit:**
  - [Overview](https://docs.base.org/base-app/build-with-minikit/overview)
  - [Quickstart](https://docs.base.org/base-app/build-with-minikit/quickstart)
- **Google Gemini API:**
  - [Node.js SDK Quickstart](https://ai.google.dev/gemini-api/docs/quickstart/node)
- **Supabase:**
  - [Official Docs](https://supabase.com/docs)
  - [JavaScript Client Library](https://supabase.com/docs/reference/javascript/start)
- **Next.js App Router:**
  - [Official Docs](https://nextjs.org/docs/app)
- **Tailwind CSS:**
  - [Official Docs](https://tailwindcss.com/docs)
- **Vercel Cron Jobs:**
  - [Official Docs](https://vercel.com/docs/cron-jobs)

---

<!-- end of file -->
